# TRAKD - Tandem Repeat Analysis with K-mer Decomposition

TRAKD is a high-performance bioinformatics toolkit for analyzing repetitive sequences in genomes using k-mer decomposition. It identifies tandem repeats, clustered repetitive elements, and analyzes their distribution patterns across genomic sequences.

## Features

- **Fast k-mer indexing** with multi-threaded processing
- **Locus detection** for identifying clusters of repetitive sequences
- **Distance analysis** for understanding repeat spacing patterns
- **Detailed statistics** including entropy calculations and Jaccard similarity metrics
- **Memory-efficient** processing of large genomes
- **Cross-platform** support (Linux, macOS, Windows)

## Installation

### Requirements
- C++17 compatible compiler (g++ 7.0+ or clang++ 5.0+)
- POSIX threads (pthread)
- Make

### Building from source
```bash
# Clone the repository
git clone https://github.com/aglabx/TRAKD.git
cd TRAKD

# Build all tools
make

# Or build with debug symbols
make debug
```

The compiled executables will be in the `bin/` directory.

## Tools Overview

TRAKD consists of four complementary tools that work together in a pipeline:

### 1. kmer_analyzer
Analyzes k-mer frequencies and positions in FASTA sequences.

```bash
bin/kmer_analyzer <input.fasta> <output_top100.txt> <output_full.bin> <output_contigs.cidx> [cache.kidx] [threads]
```

**Parameters:**
- `input.fasta`: Multi-FASTA file to analyze
- `output_top100.txt`: Text file with top 100 most frequent k-mers
- `output_full.bin`: Binary file containing all k-mer data
- `output_contigs.cidx`: Contig index file
- `cache.kidx`: (Optional) Cache file for faster re-analysis
- `threads`: (Optional) Number of threads (default: all available)

**Output format (top100.txt):**
```
AAAAAAAAAAAAA   150000  100,100,100,200,300...
TTTTTTTTTTTTT   120000  50,50,100,150...
```

### 2. locus_bed_generator
Identifies genomic loci where k-mers cluster together.

```bash
bin/locus_bed_generator <input.bin> <reference.fai> <output.bed> [min_tf] [locus_gap] [min_locus_kmers] [threads]
```

**Parameters:**
- `input.bin`: Binary file from kmer_analyzer
- `reference.fai`: FASTA index file (.fai)
- `output.bed`: Output BED file with loci
- `min_tf`: (Optional) Minimum k-mer frequency (default: 100)
- `locus_gap`: (Optional) Maximum gap within a locus (default: 10000)
- `min_locus_kmers`: (Optional) Minimum k-mers per locus (default: 2)
- `threads`: (Optional) Number of threads

**Output format (BED):**
```
track name="KmerLoci" description="K-mer loci generated by TRAKD"
chr1    1000    2000    locus_1_len_1000
chr1    5000    7500    locus_2_len_2500
```

### 3. LocusBedGeneratorDetailed
Advanced locus detection with detailed statistics and intelligent merging.

```bash
bin/LocusBedGeneratorDetailed <input.bin> <reference.fai> <output.bed> [min_tf] [locus_gap] [min_locus_kmers] [inter_overlap] [jaccard_thresh] [threads]
```

**Additional parameters:**
- `inter_overlap`: Strong overlap threshold for merging (default: 0.9)
- `jaccard_thresh`: Jaccard similarity threshold (default: 0.5)

**Output format (BED with detailed annotations):**
```
track name="DetailedKmerLoci" description="Detailed k-mer loci with statistics"
chr1    1000    2000    AAAAAAAAAAAAA|tf:150000|local_tf:1000|entropy:2.5|loci:10|max_size:5000|n_kmers:25|jaccard_min:0.3|med:0.5|max:0.8
```

### 4. distance_analyzer_detailed
Analyzes distance distributions between k-mer occurrences.

```bash
bin/distance_analyzer_detailed <input.bin> <output.tsv> [min_tf] [min_frac] [locus_gap] [threads]
```

**Parameters:**
- `input.bin`: Binary file from kmer_analyzer
- `output.tsv`: Output TSV file with analysis
- `min_tf`: (Optional) Minimum k-mer frequency (default: 0)
- `min_frac`: (Optional) Minimum distance fraction (default: 0.0)
- `locus_gap`: (Optional) Locus gap threshold (default: 10000)
- `threads`: (Optional) Number of threads

**Output format (TSV):**
```
kmer    kmer_tf    dist_entropy    locus_count    max_locus_size    distances_summary
AAAAAAAAAAAAA    150000    2.5    10    5000    100:5000:0.033|200:3000:0.020|...
```

## Usage Example

Here's a typical workflow for analyzing tandem repeats in a genome:

```bash
# Step 1: Index k-mers in your genome
bin/kmer_analyzer genome.fasta top100_kmers.txt kmers.bin contigs.cidx

# Step 2: Generate FASTA index if you don't have one
samtools faidx genome.fasta

# Step 3: Identify loci with clustered k-mers
bin/locus_bed_generator kmers.bin genome.fasta.fai loci.bed 100 10000 2

# Step 4: Get detailed locus analysis (optional)
bin/LocusBedGeneratorDetailed kmers.bin genome.fasta.fai detailed_loci.bed 100 10000 2 0.9 0.5

# Step 5: Analyze distance patterns (optional)
bin/distance_analyzer_detailed kmers.bin distances.tsv 100 0.01
```

## Understanding the Output

### K-mer Frequencies
The `kmer_analyzer` identifies all 13-mers in your sequences and tracks:
- Total frequency (tf): How many times the k-mer appears
- Positions: Where each occurrence is located
- Distances: Spacing between consecutive occurrences

### Loci Detection
Loci are regions where multiple k-mers cluster together, typically indicating:
- Tandem repeats
- Transposable element clusters
- Other repetitive elements

### Distance Analysis
The distance analyzer helps identify:
- Regular spacing patterns (low entropy)
- Random distributions (high entropy)
- Clustered vs. dispersed repeat patterns

## Performance Tips

1. **Use caching**: The `.kidx` cache file speeds up re-analysis of the same genome
2. **Adjust thread count**: Use fewer threads if memory is limited
3. **Filter by frequency**: Higher `min_tf` values focus on more repetitive elements
4. **Tune locus parameters**: Adjust `locus_gap` based on your repeat characteristics

## Applications

TRAKD is useful for:
- Identifying tandem repeats and satellites
- Analyzing transposable element distributions
- Studying centromeric and telomeric repeats
- Genome assembly quality assessment
- Comparative genomics of repetitive elements

## Citation

If you use TRAKD in your research, please cite:
```
TRAKD: Tandem Repeat Analysis with K-mer Decomposition
https://github.com/aglabx/TRAKD
```

## License

TRAKD is released under the MIT License. See [LICENSE](LICENSE) file for details.

## Contributing

Contributions are welcome! Please feel free to submit issues or pull requests on GitHub.

## Contact

For questions or support, please open an issue on the [GitHub repository](https://github.com/aglabx/TRAKD).